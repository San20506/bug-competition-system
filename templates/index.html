<!DOCTYPE html>
<html>
<head>
    <title>Bug Fix Submission</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .timer { font-size: 24px; color: #ff6b35; font-weight: bold; margin: 10px 0; }
        .timer.expired { color: #ff0000; }
        .form-section { margin: 20px 0; }
        button { padding: 10px 20px; font-size: 16px; }
        .upload-help { color: #666; font-size: 14px; margin-top: 10px; }
        .nav-links { margin: 20px 0; }
        .nav-links a { margin-right: 15px; text-decoration: none; color: #007bff; }
        .nav-links a:hover { text-decoration: underline; }
        .upload-instructions { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            margin-top: 15px;
        }
        .upload-instructions ol { margin: 10px 0; }
        .upload-instructions li { margin: 5px 0; }
        .upload-instructions a { color: #007bff; }
    </style>
    <script>
        let remainingTime = {{ remaining }};
        let timerActive = {{ 'true' if timer_active else 'false' }};

        function updateTimer() {
            const timerElement = document.getElementById('timer');
            const submitButton = document.getElementById('submit-btn');

            if (remainingTime <= 0) {
                timerElement.innerHTML = "‚è∞ Time's up!";
                timerElement.className = "timer expired";
                if (submitButton) submitButton.disabled = true;
                return;
            }

            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            timerElement.innerHTML = `‚è≥ Time Remaining: ${formattedTime}`;
            remainingTime--;
        }

        function startTimer() {
            if (timerActive && remainingTime > 0) {
                updateTimer();
                setInterval(updateTimer, 1000);
            }
        }

        window.onload = startTimer;
    </script>
</head>
<body>
    <h2>üõ†Ô∏è Bug Fix Challenge</h2>
    <p>Welcome, <strong>{{ session.team }}</strong>! <a href="/logout">Logout</a></p>

    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if timer_active %}
        <div id="timer" class="timer">‚è≥ Time Remaining: Loading...</div>

        <div class="form-section">
            <h3>üìÅ Submit Your Fix</h3>
            <form method="POST" enctype="multipart/form-data">
                <input type="file" name="zipfile" accept=".zip" required><br><br>
                <button id="submit-btn" type="submit">Submit Fix</button>
            </form>
        </div>
    {% else %}
        <div class="timer expired">‚è±Ô∏è Submissions are currently closed.</div>
    {% endif %}

    <div class="nav-links">
        <a href="/bug">üêõ View Bug Site (QR Code)</a>
        <a href="/leaderboard">üìä View Leaderboard</a>
    </div>
</body>
</html>